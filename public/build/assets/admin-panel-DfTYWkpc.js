import{j}from"./vendor-DZtHqBjz.js";let C;const F={labels:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],datasets:[{label:"میزان فروش",data:[120,190,150,220,180,250,200,280,230,300,270,350],backgroundColor:"rgba(56, 161, 105, 0.6)",borderColor:"rgba(56, 161, 105, 1)",borderWidth:1,fill:!0,tension:.3}]},N={type:"line",data:F,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1,labels:{font:{family:"Vazirmatn"}}},tooltip:{rtl:!0,callbacks:{label:function(t){let n=t.dataset.label||"";return n&&(n+=": "),t.parsed.y!==null&&(n+=t.parsed.y.toLocaleString("fa-IR")+" میلیون تومان"),n}},titleFont:{family:"Vazirmatn"},bodyFont:{family:"Vazirmatn"}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"میزان فروش (میلیون تومان)",font:{family:"Vazirmatn"}},ticks:{callback:function(t){return t.toLocaleString("fa-IR")},font:{family:"Vazirmatn"}}},x:{title:{display:!0,text:"ماه",font:{family:"Vazirmatn"}},ticks:{font:{family:"Vazirmatn"}}}},layout:{padding:{left:10,right:10,top:10,bottom:10}}}};function z(){const t=document.getElementById("monthlySalesChart");t&&typeof Chart<"u"&&!C?(C=new Chart(t.getContext("2d"),N),console.log("Monthly sales chart initialized.")):t?C?console.log("Monthly sales chart already initialized."):typeof Chart>"u"&&console.error("Chart.js library is not loaded. Cannot initialize chart."):console.warn('Canvas element with ID "monthlySalesChart" not found.')}function D(){C?(C.resize(),console.log("Monthly sales chart resized.")):console.warn("Monthly sales chart instance not found for resize operation.")}function P(){console.log("Charts module initializing..."),z()}const X=Object.freeze(Object.defineProperty({__proto__:null,initCharts:P,initializeMonthlySalesChart:z,updateChartOnResize:D},Symbol.toStringTag,{value:"Module"}));let p=[];function R(){const t=document.getElementById("admin-activity-log");t&&(t.innerHTML="",window.adminActivityLog&&window.adminActivityLog.slice().reverse().forEach(n=>{const s=document.createElement("div");s.className="p-2 bg-gray-50 rounded-md text-sm text-gray-700",s.innerHTML=`
                <p><span class="font-semibold">${n.username}</span>: ${n.action} - <span class="text-gray-500">${new Date(n.timestamp).toLocaleString("fa-IR")}</span></p>
                <span class="text-xs text-gray-400">${n.details}</span>
            `,t.appendChild(s)}))}let M=1,T=5,S="id",k="asc",$="",y=new Set;async function L(t=M,n=T,s=S,e=k,r=$){const a=document.getElementById("loading-state"),o=document.getElementById("user-list-body"),i=document.getElementById("no-users-message");a&&a.classList.remove("hidden"),o&&(o.innerHTML=""),i&&i.classList.add("hidden");try{await new Promise(I=>setTimeout(I,500));const d=[...p.filter(I=>I.username.toLowerCase().includes(r.toLowerCase())||I.email.toLowerCase().includes(r.toLowerCase())||I.role.toLowerCase().includes(r.toLowerCase()))].sort((I,x)=>{let b=I[s],g=x[s];return s==="id"&&(b=parseInt(b),g=parseInt(g)),s==="created_at"&&(b=new Date(b).getTime(),g=new Date(g).getTime()),b<g?e==="asc"?-1:1:b>g?e==="asc"?1:-1:0}),f=d.length,m=Math.ceil(f/n),w=(t-1)*n,h=w+n,l=d.slice(w,h);M=t,S=s,k=e,$=r,V(l),_(m,M),U(),l.length===0&&i&&i.classList.remove("hidden")}catch(u){console.error("Error fetching users:",u),window.showMessage("خطا در بارگذاری لیست کاربران.","error"),i&&i.classList.remove("hidden"),o&&(o.innerHTML='<tr><td colspan="9" class="py-3 px-6 text-center text-red-500">خطا در بارگذاری اطلاعات.</td></tr>')}finally{a&&a.classList.add("hidden")}}function V(t){const n=document.getElementById("user-list-body");if(!n)return;n.innerHTML="",y.clear();const s=document.getElementById("select-all");if(s&&(s.checked=!1),H(),t.length===0){const e=document.getElementById("no-users-message");e&&e.classList.remove("hidden");return}else{const e=document.getElementById("no-users-message");e&&e.classList.add("hidden")}t.forEach(e=>{const r=document.createElement("tr");r.className="border-b border-gray-200 hover:bg-gray-50";const a=new Date(e.created_at),o=j.toJalaali(a.getFullYear(),a.getMonth()+1,a.getDate()),i=`${o.jy}/${String(o.jm).padStart(2,"0")}/${String(o.jd).padStart(2,"0")}`,u={active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-800",suspended:"bg-yellow-100 text-yellow-800"}[e.status]||"bg-gray-100 text-gray-800",d={admin:"bg-red-100 text-red-800",user:"bg-green-100 text-green-800",editor:"bg-blue-100 text-blue-800",moderator:"bg-purple-100 text-purple-800"}[e.role]||"bg-gray-100 text-gray-800";r.innerHTML=`
            <td class="py-3 px-6 text-right">
                <input type="checkbox" class="user-checkbox rounded text-green-600 focus:ring-green-500" data-user-id="${e.id}">
            </td>
            <td class="py-3 px-6 text-right whitespace-nowrap">${e.id}</td>
            <td class="py-3 px-6 text-right whitespace-nowrap">${e.username}</td>
            <td class="py-3 px-6 text-right whitespace-nowrap">${e.email}</td>
            <td class="py-3 px-6 text-right whitespace-nowrap">
                <span class="px-2 py-1 font-semibold leading-tight rounded-full ${d}">
                    ${e.role==="admin"?"مدیر":e.role==="user"?"کاربر":e.role==="editor"?"ویرایشگر":e.role==="moderator"?"مدیر محتوا":e.role}
                </span>
            </td>
            <td class="py-3 px-6 text-right whitespace-nowrap">${e.lastLocation}</td>
            <td class="py-3 px-6 text-right whitespace-nowrap">${i}</td>
            <td class="py-3 px-6 text-right whitespace-nowrap">
                <span class="px-2 py-1 font-semibold leading-tight rounded-full ${u}">
                    ${e.status==="active"?"فعال":e.status==="inactive"?"غیرفعال":e.status}
                </span>
            </td>
            <td class="py-3 px-6 text-center whitespace-nowrap">
                <div class="flex item-center justify-center space-x-2 space-x-reverse">
                    <button class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center hover:bg-blue-600 transition duration-200 edit-user-btn" data-user-id="${e.id}" title="ویرایش">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 transition duration-200 delete-user-btn" data-user-id="${e.id}" title="حذف">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `,n.appendChild(r)}),n.querySelectorAll(".user-checkbox").forEach(e=>{e.addEventListener("change",Z)}),n.querySelectorAll(".edit-user-btn").forEach(e=>{e.addEventListener("click",r=>window.showUserModal(parseInt(r.currentTarget.dataset.userId)))}),n.querySelectorAll(".delete-user-btn").forEach(e=>{e.addEventListener("click",r=>window.deleteUser(parseInt(r.currentTarget.dataset.userId)))})}function _(t,n){const s=document.getElementById("pagination-container");if(!s||(s.innerHTML="",t<=1))return;const e=document.createElement("button");e.className=`px-3 py-1 rounded-md border border-gray-300 ${n===1?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-100"}`,e.innerHTML='<i class="fas fa-chevron-right"></i>',e.disabled=n===1,e.addEventListener("click",()=>L(n-1)),s.appendChild(e);const r=5;let a=Math.max(1,n-Math.floor(r/2)),o=Math.min(t,a+r-1);o-a+1<r&&(a=Math.max(1,o-r+1));for(let u=a;u<=o;u++){const d=document.createElement("button");d.className=`px-3 py-1 rounded-md border border-gray-300 mx-1 ${u===n?"bg-brown-900 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,d.textContent=u.toLocaleString("fa-IR"),d.addEventListener("click",()=>L(u)),s.appendChild(d)}const i=document.createElement("button");i.className=`px-3 py-1 rounded-md border border-gray-300 ${n===t?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-100"}`,i.innerHTML='<i class="fas fa-chevron-left"></i>',i.disabled=n===t,i.addEventListener("click",()=>L(n+1)),s.appendChild(i)}window.showUserModal=function(t=null){const n=document.getElementById("user-modal-overlay"),s=document.getElementById("user-modal-title"),e=document.getElementById("user-id"),r=document.getElementById("username"),a=document.getElementById("email"),o=document.getElementById("role"),i=document.getElementById("status"),u=document.getElementById("phone"),d=document.getElementById("password"),f=document.getElementById("password-required"),m=document.getElementById("password_confirmation"),w=document.getElementById("password-confirm-required"),h=document.getElementById("user-form-method");if(!n||!s||!d||!m){console.error("Required modal elements not found"),window.showMessage("خطا در بارگذاری فرم کاربر.","error");return}if(W(),t){const l=p.find(I=>I.id===t);if(!l){window.showMessage("کاربر یافت نشد.","error");return}s.textContent="ویرایش کاربر",e&&(e.value=l.id),r&&(r.value=l.username),a&&(a.value=l.email),o&&(o.value=l.role),i&&(i.value=l.status),u&&(u.value=l.phone||""),console.log("User ID exists. Setting password fields to not required."),d?(d.required=!1,console.log("passwordInput.required set to false.")):console.error("passwordInput element not found"),m?(m.required=!1,console.log("passwordConfirmationInput.required set to false.")):console.error("passwordConfirmationInput element not found"),f?(console.log("passwordRequired element found. Hiding it."),f.classList.add("hidden")):console.log("passwordRequired element NOT found."),w?(console.log("passwordConfirmRequired element found. Hiding it."),w.classList.add("hidden")):console.log("passwordConfirmRequired element NOT found."),h&&(h.value="PUT")}else s.textContent="افزودن کاربر جدید",e&&(e.value=""),console.log("New user. Setting password fields to required."),d?(console.log("Attempting to set passwordInput.required = true;"),d.required=!0,console.log("passwordInput.required set to true.")):console.error("passwordInput element not found"),m?(console.log("Attempting to set passwordConfirmationInput.required = true;"),m.required=!0,console.log("passwordConfirmationInput.required set to true.")):console.error("passwordConfirmationInput element not found"),f?(console.log("passwordRequired element found. Showing it."),f.classList.remove("hidden")):console.log("passwordRequired element NOT found."),w?(console.log("passwordConfirmRequired element found. Showing it."),w.classList.remove("hidden")):console.log("passwordConfirmRequired element NOT found."),h&&(h.value="POST");n.classList.remove("hidden"),n.classList.add("active")};function W(){const t=document.getElementById("user-form");if(t){t.reset(),t.querySelectorAll(".invalid-feedback").forEach(e=>e.classList.add("hidden")),t.querySelectorAll("input, select").forEach(e=>e.classList.remove("border-red-500"));const n=document.getElementById("form-errors");n&&n.classList.add("hidden");const s=document.getElementById("error-list");s&&(s.innerHTML="")}}function J(t){if(!t)return console.error("Form element is null"),!1;let n=!0;const s=document.getElementById("error-list"),e=document.getElementById("form-errors");s&&(s.innerHTML=""),e&&e.classList.add("hidden"),t.querySelectorAll(".invalid-feedback").forEach(l=>{l&&l.classList&&l.classList.add("hidden")}),t.querySelectorAll("input, select").forEach(l=>{l&&l.classList&&l.classList.remove("border-red-500")});const o=document.getElementById("username"),i=document.getElementById("email"),u=document.getElementById("role"),d=document.getElementById("password"),f=document.getElementById("password_confirmation"),m=document.getElementById("phone");o&&o.value.trim()===""&&(B(o,"نام کاربری نمی‌تواند خالی باشد."),n=!1),i&&(i.value.trim()===""||!/\S+@\S+\.\S+/.test(i.value))&&(B(i,"ایمیل نامعتبر است."),n=!1),u&&u.value===""&&(B(u,"نقش کاربر را انتخاب کنید."),n=!1);const w=document.getElementById("user-id"),h=!w||!w.value;return d&&f&&(h||d.value!==""||f.value!=="")&&(d.value.length<8&&(B(d,"رمز عبور باید حداقل 8 کاراکتر باشد."),n=!1),d.value!==f.value&&(B(f,"رمز عبور و تکرار آن مطابقت ندارند."),n=!1)),m&&m.value.trim()!==""&&!/^09\d{9}$/.test(m.value)&&(B(m,"شماره تلفن نامعتبر است. (مثال: 09123456789)"),n=!1),!n&&e&&e.classList.remove("hidden"),n}function B(t,n){if(!t){console.error("inputElement is null or undefined");return}const s=t.nextElementSibling;s&&s.classList.contains("invalid-feedback")&&(s.textContent=n,s.classList.remove("hidden")),t.classList&&t.classList.add("border-red-500");const e=document.getElementById("error-list");if(e){const r=document.createElement("li");r&&(r.textContent=n,e.appendChild(r))}}async function Q(t){t.preventDefault();const n=t.target;if(!J(n)){window.showMessage("لطفاً خطاهای فرم را برطرف کنید.","error");return}const s=document.getElementById("user-id"),e=document.getElementById("username"),r=document.getElementById("email"),a=document.getElementById("role"),o=document.getElementById("status"),i=document.getElementById("phone"),u=document.getElementById("password"),d=document.getElementById("password_confirmation");if(!e||!r||!a||!o){window.showMessage("خطا در بارگذاری فرم. لطفاً صفحه را reload کنید.","error");return}const f=s?s.value:"",m=e.value,w=r.value,h=a.value,l=o.value,I=i?i.value:"",x=u?u.value:"",b={username:m,email:w,role:h,status:l,phone:I};x&&(b.password=x,d&&(b.password_confirmation=d.value));const g=document.getElementById("submit-btn");if(!g){console.error("Submit button not found");return}const c=g.innerHTML;g&&(g.disabled=!0,g.innerHTML='<i class="fas fa-spinner fa-spin ml-2"></i><span>در حال ذخیره...</span>');try{if(await new Promise(E=>setTimeout(E,800)),f){const E=p.findIndex(A=>A.id===parseInt(f));E!==-1?(p[E]={...p[E],...b},window.showMessage("کاربر با موفقیت ویرایش شد.","success"),window.logAdminAction(window.currentUser.username,"ویرایش کاربر",`کاربر ${m} (شناسه: ${f}) ویرایش شد.`)):window.showMessage("کاربر برای ویرایش یافت نشد.","error")}else{const A={id:p.length>0?Math.max(...p.map(O=>O.id))+1:1,username:m,email:w,role:h,lastLocation:"N/A",created_at:new Date().toISOString(),status:l,phone:I};p.push(A),window.showMessage("کاربر جدید با موفقیت اضافه شد.","success"),window.logAdminAction(window.currentUser.username,"افزودن کاربر",`کاربر ${m} اضافه شد.`)}const v=document.getElementById("user-modal-overlay");v&&(v.classList.add("hidden"),v.classList.remove("active")),L()}catch(v){console.error("Error saving user:",v),window.showMessage("خطا در ذخیره کاربر: "+v.message,"error")}finally{g&&(g.disabled=!1,g.innerHTML=c)}}window.deleteUser=function(t){const n=p.find(s=>s.id===t);if(!n){window.showMessage("کاربر یافت نشد.","error");return}window.showConfirmationModal("تایید حذف کاربر",`آیا از حذف کاربر "${n.username}" مطمئن هستید؟ این عملیات قابل بازگشت نیست.`,async()=>{try{await new Promise(e=>setTimeout(e,500));const s=p.findIndex(e=>e.id===t);s>-1?(p.splice(s,1),window.showMessage("کاربر با موفقیت حذف شد.","success"),window.logAdminAction(window.currentUser.username,"حذف کاربر",`کاربر ${n.username} (شناسه: ${t}) حذف شد.`)):window.showMessage("خطا در حذف کاربر. کاربر یافت نشد.","error"),L(M)}catch(s){console.error("Error deleting user:",s),window.showMessage("خطا در حذف کاربر: "+s.message,"error")}},()=>{window.showMessage("عملیات حذف کاربر لغو شد.","info")})};function H(){const t=document.getElementById("bulk-actions");t&&(y.size>0?t.classList.remove("hidden"):t.classList.add("hidden"))}function U(){const t=document.getElementById("select-all"),n=document.querySelectorAll(".user-checkbox");n.length>0&&y.size===n.length&&y.size>0?t&&(t.checked=!0):t&&(t.checked=!1),H()}function Y(t){const n=t.target.checked;document.querySelectorAll(".user-checkbox").forEach(s=>{s.checked=n;const e=parseInt(s.dataset.userId);n?y.add(e):y.delete(e)}),U()}function Z(t){const n=parseInt(t.target.dataset.userId);t.target.checked?y.add(n):y.delete(n),U()}async function q(t){if(y.size===0){window.showMessage("هیچ کاربری انتخاب نشده است.","info");return}const s=Array.from(y).map(o=>p.find(i=>i.id===o)).filter(Boolean).map(o=>o.username).join(", ");let e="",r="",a="";if(t==="delete")e=`آیا از حذف ${y.size} کاربر انتخاب شده (${s}) مطمئن هستید؟ این عملیات قابل بازگشت نیست.`,r="کاربران انتخاب شده با موفقیت حذف شدند.",a="حذف گروهی کاربران";else if(t==="activate")e=`آیا از فعال کردن ${y.size} کاربر انتخاب شده (${s}) مطمئن هستید؟`,r="کاربران انتخاب شده با موفقیت فعال شدند.",a="فعال‌سازی گروهی کاربران";else if(t==="deactivate")e=`آیا از غیرفعال کردن ${y.size} کاربر انتخاب شده (${s}) مطمئن هستید؟`,r="کاربران انتخاب شده با موفقیت غیرفعال شدند.",a="غیرفعال‌سازی گروهی کاربران";else return;window.showConfirmationModal("تایید عملیات گروهی",e,async()=>{try{await new Promise(o=>setTimeout(o,800)),t==="delete"?p=p.filter(o=>!y.has(o.id)):p.forEach(o=>{y.has(o.id)&&(t==="activate"&&(o.status="active"),t==="deactivate"&&(o.status="inactive"))}),window.showMessage(r,"success"),window.logAdminAction(window.currentUser.username,a,`عملیات روی کاربران: ${s}`),y.clear(),L()}catch(o){console.error("Error performing bulk action:",o),window.showMessage("خطا در انجام عملیات گروهی: "+o.message,"error")}},()=>{window.showMessage("عملیات گروهی لغو شد.","info")})}function G(){var x,b,g;console.log("Admin module initializing..."),window.location.pathname.startsWith("/admin/")&&(window.showSection("dashboard"),R(),p.find(v=>v.username===window.currentUser.username)?window.logAdminAction(window.currentUser.username,"ورود به پنل","ورود موفق به سیستم"):window.showMessage("کاربر ادمین شبیه‌سازی شده یافت نشد. به عنوان کاربر پیش‌فرض عمل می‌کنیم.","info"));const t=document.getElementById("sidebar-toggle"),n=document.getElementById("sidebar"),s=document.getElementById("main-content-wrapper"),e=document.querySelectorAll(".nav-text");t&&n&&s&&e.length>0&&t.addEventListener("click",()=>{n.classList.toggle("sidebar-expanded"),n.classList.toggle("sidebar-collapsed"),s.classList.toggle("main-content-shifted"),s.classList.toggle("main-content-full"),e.forEach(c=>{c.classList.toggle("hidden")}),setTimeout(()=>{D()},300)});const r=document.getElementById("notification-button"),a=document.getElementById("notification-dropdown");r&&a&&(r.addEventListener("click",c=>{a.classList.toggle("hidden"),c.stopPropagation()}),document.addEventListener("click",c=>{!a.contains(c.target)&&!r.contains(c.target)&&a.classList.add("hidden")}));const o=document.getElementById("toggle-report-actions"),i=document.getElementById("report-actions-container");o&&i&&(o.addEventListener("click",c=>{c.stopPropagation();const v=o.getAttribute("aria-expanded")==="true";o.setAttribute("aria-expanded",String(!v)),i.classList.toggle("hidden"),i.classList.toggle("active")}),document.addEventListener("click",c=>{!i.contains(c.target)&&!o.contains(c.target)&&(i.classList.add("hidden"),i.classList.remove("active"),o.setAttribute("aria-expanded","false"))}),i.querySelectorAll("a").forEach(c=>{c.addEventListener("click",()=>{i.classList.add("hidden"),i.classList.remove("active"),o.setAttribute("aria-expanded","false")})}));function u(){const c=new Date,v={hour:"2-digit",minute:"2-digit",hour12:!1,day:"2-digit",month:"2-digit",year:"numeric"},E=document.getElementById("current-time");E&&(E.textContent=c.toLocaleString("fa-IR",v).replace(","," -"))}setInterval(u,1e3),u();const d=document.getElementById("user-search");if(d){let c;d.addEventListener("keyup",()=>{clearTimeout(c),c=setTimeout(()=>{L(1,T,S,k,d.value.trim())},300)})}document.querySelectorAll("#user-management-content th[data-sort]").forEach(c=>{c.addEventListener("click",()=>{const v=c.dataset.sort;let E="asc";S===v&&(E=k==="asc"?"desc":"asc"),L(1,T,v,E,$)})});const f=document.getElementById("add-user-btn");f&&f.addEventListener("click",()=>window.showUserModal(null));const m=document.getElementById("user-modal-close-btn"),w=document.getElementById("user-form-cancel-btn"),h=document.getElementById("user-modal-overlay");m&&m.addEventListener("click",()=>{h.classList.add("hidden"),h.classList.remove("active")}),w&&w.addEventListener("click",()=>{h.classList.add("hidden"),h.classList.remove("active")});const l=document.getElementById("user-form");l&&l.addEventListener("submit",Q);const I=document.getElementById("select-all");I&&I.addEventListener("change",Y),(x=document.getElementById("bulk-delete"))==null||x.addEventListener("click",()=>q("delete")),(b=document.getElementById("bulk-activate"))==null||b.addEventListener("click",()=>q("activate")),(g=document.getElementById("bulk-deactivate"))==null||g.addEventListener("click",()=>q("deactivate")),console.log("Admin module initialized successfully.")}const ee=Object.freeze(Object.defineProperty({__proto__:null,initAdminPanel:G,renderActivityLog:R,get users(){return p}},Symbol.toStringTag,{value:"Module"}));export{ee as a,X as c};
//# sourceMappingURL=admin-panel-DfTYWkpc.js.map
