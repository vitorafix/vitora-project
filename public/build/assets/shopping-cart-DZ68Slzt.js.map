{"version":3,"file":"shopping-cart-DZ68Slzt.js","sources":["../../../resources/js/cart/export.js"],"sourcesContent":["// resources/js/cart/export.js\r\n\r\n// نیازی به import showMessage نیست چون به صورت global در window تعریف شده است.\r\n// کتابخانه‌های XLSX, jspdf و html2canvas باید به صورت گلوبال در دسترس باشند\r\n// یا توسط Vite به صورت جداگانه Bundle و لود شوند.\r\n// فرض بر این است که این کتابخانه‌ها از طریق <script> تگ در HTML یا تنظیمات Vite لود می‌شوند.\r\n\r\nexport function setupExportButtons() {\r\n    // دکمه Export Excel\r\n    const exportExcelButton = document.getElementById('export-excel');\r\n\r\n    if (exportExcelButton) {\r\n        exportExcelButton.addEventListener('click', () => {\r\n            // اطمینان حاصل کنید که XLSX به صورت گلوبال در دسترس است\r\n            if (typeof XLSX === 'undefined') {\r\n                if (typeof window.showMessage === 'function') {\r\n                    window.showMessage('خطا: کتابخانه XLSX برای صادرات اکسل یافت نشد.', 'error');\r\n                } else {\r\n                    console.error('Error: XLSX library not found for Excel export.');\r\n                }\r\n                return;\r\n            }\r\n\r\n            const data = [\r\n                ['نام محصول', 'قیمت', 'موجودی'],\r\n                ['چای سیاه', 50000, 1000],\r\n                ['چای سبز', 60000, 500],\r\n                ['چای ارل گری', 75000, 300],\r\n            ];\r\n\r\n            const ws = XLSX.utils.aoa_to_sheet(data);\r\n            const wb = XLSX.utils.book_new();\r\n            XLSX.utils.book_append_sheet(wb, ws, 'گزارش محصولات');\r\n            XLSX.writeFile(wb, 'گزارش_محصولات.xlsx');\r\n\r\n            if (typeof window.showMessage === 'function') {\r\n                window.showMessage('فایل اکسل با موفقیت صادر شد.', 'success');\r\n            } else {\r\n                console.log('فایل اکسل با موفقیت صادر شد.');\r\n            }\r\n        });\r\n    }\r\n\r\n    // دکمه Export PDF\r\n    const exportPdfButton = document.getElementById('export-pdf');\r\n\r\n    if (exportPdfButton) {\r\n        exportPdfButton.addEventListener('click', async () => {\r\n            // اطمینان حاصل کنید که jspdf و html2canvas به صورت گلوبال در دسترس هستند\r\n            if (typeof window.jspdf === 'undefined' || typeof html2canvas === 'undefined') {\r\n                if (typeof window.showMessage === 'function') {\r\n                    window.showMessage('خطا: کتابخانه‌های jspdf یا html2canvas برای صادرات PDF یافت نشدند.', 'error');\r\n                } else {\r\n                    console.error('Error: jspdf or html2canvas libraries not found for PDF export.');\r\n                }\r\n                return;\r\n            }\r\n\r\n            const { jsPDF } = window.jspdf; // دسترسی به jsPDF از window\r\n            const doc = new jsPDF();\r\n\r\n            const content = document.getElementById('reports-content');\r\n\r\n            if (!content) {\r\n                if (typeof window.showMessage === 'function') {\r\n                    window.showMessage('محتوای گزارش برای تولید PDF یافت نشد.', 'error');\r\n                } else {\r\n                    console.log('محتوای گزارش برای تولید PDF یافت نشد.');\r\n                }\r\n                return;\r\n            }\r\n\r\n            // اگر محتوا مخفی بود، موقتاً نشان داده شود\r\n            const isHidden = content.classList.contains('hidden') || !content.classList.contains('active');\r\n\r\n            if (isHidden) {\r\n                content.style.display = 'block';\r\n                content.classList.add('temp-visible-for-pdf');\r\n            }\r\n\r\n            try {\r\n                const canvas = await html2canvas(content, {\r\n                    scale: 2,\r\n                    useCORS: true,\r\n                    windowWidth: document.body.scrollWidth,\r\n                    windowHeight: document.body.scrollHeight,\r\n                });\r\n\r\n                const imgData = canvas.toDataURL('image/png');\r\n                const imgWidth = 210; // A4 عرض mm\r\n                const pageHeight = 297; // A4 ارتفاع mm\r\n                const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n                let heightLeft = imgHeight;\r\n                let position = 0;\r\n\r\n                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\r\n                heightLeft -= pageHeight;\r\n\r\n                while (heightLeft > 0) {\r\n                    position = heightLeft - imgHeight;\r\n                    doc.addPage();\r\n                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\r\n                    heightLeft -= pageHeight;\r\n                }\r\n\r\n                doc.save('گزارش.pdf');\r\n\r\n                if (typeof window.showMessage === 'function') {\r\n                    window.showMessage('فایل PDF با موفقیت صادر شد.', 'success');\r\n                } else {\r\n                    console.log('فایل PDF با موفقیت صادر شد.');\r\n                }\r\n            } catch (error) {\r\n                console.error('Error generating PDF:', error);\r\n                if (typeof window.showMessage === 'function') {\r\n                    window.showMessage('خطا در تولید PDF: ' + error.message, 'error');\r\n                } else {\r\n                    console.log('خطا در تولید PDF: ' + error.message);\r\n                }\r\n            } finally {\r\n                if (isHidden) {\r\n                    content.style.display = '';\r\n                    content.classList.remove('temp-visible-for-pdf');\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// The document.addEventListener('DOMContentLoaded') block is removed from here.\r\n// app.js will dynamically import this module and call setupExportButtons().\r\n"],"names":["setupExportButtons","exportExcelButton","data","ws","wb","exportPdfButton","jsPDF","doc","content","isHidden","canvas","imgData","imgWidth","pageHeight","imgHeight","heightLeft","position","error"],"mappings":"AAOO,SAASA,GAAqB,CAEjC,MAAMC,EAAoB,SAAS,eAAe,cAAc,EAE5DA,GACAA,EAAkB,iBAAiB,QAAS,IAAM,CAE9C,GAAI,OAAO,KAAS,IAAa,CACzB,OAAO,OAAO,aAAgB,WAC9B,OAAO,YAAY,gDAAiD,OAAO,EAE3E,QAAQ,MAAM,iDAAiD,EAEnE,MACH,CAED,MAAMC,EAAO,CACT,CAAC,YAAa,OAAQ,QAAQ,EAC9B,CAAC,WAAY,IAAO,GAAI,EACxB,CAAC,UAAW,IAAO,GAAG,EACtB,CAAC,cAAe,KAAO,GAAG,CAC1C,EAEkBC,EAAK,KAAK,MAAM,aAAaD,CAAI,EACjCE,EAAK,KAAK,MAAM,SAAQ,EAC9B,KAAK,MAAM,kBAAkBA,EAAID,EAAI,eAAe,EACpD,KAAK,UAAUC,EAAI,oBAAoB,EAEnC,OAAO,OAAO,aAAgB,WAC9B,OAAO,YAAY,+BAAgC,SAAS,EAE5D,QAAQ,IAAI,8BAA8B,CAE1D,CAAS,EAIL,MAAMC,EAAkB,SAAS,eAAe,YAAY,EAExDA,GACAA,EAAgB,iBAAiB,QAAS,SAAY,CAElD,GAAI,OAAO,OAAO,MAAU,KAAe,OAAO,YAAgB,IAAa,CACvE,OAAO,OAAO,aAAgB,WAC9B,OAAO,YAAY,qEAAsE,OAAO,EAEhG,QAAQ,MAAM,iEAAiE,EAEnF,MACH,CAED,KAAM,CAAE,MAAAC,CAAK,EAAK,OAAO,MACnBC,EAAM,IAAID,EAEVE,EAAU,SAAS,eAAe,iBAAiB,EAEzD,GAAI,CAACA,EAAS,CACN,OAAO,OAAO,aAAgB,WAC9B,OAAO,YAAY,wCAAyC,OAAO,EAEnE,QAAQ,IAAI,uCAAuC,EAEvD,MACH,CAGD,MAAMC,EAAWD,EAAQ,UAAU,SAAS,QAAQ,GAAK,CAACA,EAAQ,UAAU,SAAS,QAAQ,EAEzFC,IACAD,EAAQ,MAAM,QAAU,QACxBA,EAAQ,UAAU,IAAI,sBAAsB,GAGhD,GAAI,CACA,MAAME,EAAS,MAAM,YAAYF,EAAS,CACtC,MAAO,EACP,QAAS,GACT,YAAa,SAAS,KAAK,YAC3B,aAAc,SAAS,KAAK,YAChD,CAAiB,EAEKG,EAAUD,EAAO,UAAU,WAAW,EACtCE,EAAW,IACXC,EAAa,IACbC,EAAaJ,EAAO,OAASE,EAAYF,EAAO,MACtD,IAAIK,EAAaD,EACbE,EAAW,EAKf,IAHAT,EAAI,SAASI,EAAS,MAAO,EAAGK,EAAUJ,EAAUE,CAAS,EAC7DC,GAAcF,EAEPE,EAAa,GAChBC,EAAWD,EAAaD,EACxBP,EAAI,QAAO,EACXA,EAAI,SAASI,EAAS,MAAO,EAAGK,EAAUJ,EAAUE,CAAS,EAC7DC,GAAcF,EAGlBN,EAAI,KAAK,WAAW,EAEhB,OAAO,OAAO,aAAgB,WAC9B,OAAO,YAAY,8BAA+B,SAAS,EAE3D,QAAQ,IAAI,6BAA6B,CAEhD,OAAQU,EAAO,CACZ,QAAQ,MAAM,wBAAyBA,CAAK,EACxC,OAAO,OAAO,aAAgB,WAC9B,OAAO,YAAY,qBAAuBA,EAAM,QAAS,OAAO,EAEhE,QAAQ,IAAI,qBAAuBA,EAAM,OAAO,CAEpE,QAAsB,CACFR,IACAD,EAAQ,MAAM,QAAU,GACxBA,EAAQ,UAAU,OAAO,sBAAsB,EAEtD,CACb,CAAS,CAET"}